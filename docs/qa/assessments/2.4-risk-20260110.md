# Risk Profile: Story 2.4

Date: 2026-01-10
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 0
- High Risks: 0
- Medium Risks: 1
- Low Risks: 4
- Minimal Risks: 1
- Risk Score: 87/100

## Risk Matrix

| Risk ID | Description | Probability | Impact | Score | Priority |
|---------|-------------|-------------|--------|-------|----------|
| PERF-001 | Export exceeds 2s for 100k rows | Medium (2) | Medium (2) | 4 | Medium |
| SEC-001 | CSV injection via special characters | Low (1) | Medium (2) | 2 | Low |
| DATA-001 | Partial write on export failure | Low (1) | Medium (2) | 2 | Low |
| OPS-001 | Permission denied on target directory | Medium (2) | Low (1) | 2 | Low |
| OPS-002 | Disk full during export | Low (1) | Medium (2) | 2 | Low |
| TECH-001 | Cross-platform path handling | Low (1) | Low (1) | 1 | Minimal |

## Medium Risks Requiring Attention

### PERF-001: Export Performance for Large Datasets

**Score: 4 (Medium)**
**Probability**: Medium - Pandas to_csv is generally fast, but 100k rows with multiple columns could approach threshold
**Impact**: Medium - Poor UX if export takes too long; NFR violation

**Mitigation**:
- Use pandas to_csv with optimized settings (index=False, no chunking needed)
- Performance test validates the 2-second requirement
- Consider progress indicator for future enhancement if needed

**Testing Focus**: Performance test with 100k row dataset

## Low Risks with Mitigations

### SEC-001: CSV Injection Vulnerability

**Score: 2 (Low)**
**Probability**: Low - Requires malicious data in source file
**Impact**: Medium - Could execute formulas if opened in spreadsheet software

**Mitigation**:
- Data is user's own trade data, not untrusted input
- No sanitization needed for this use case
- Document in user guide that CSV may contain formulas

**Testing Focus**: Unit test with special characters in data

### DATA-001: Partial Write on Export Failure

**Score: 2 (Low)**
**Probability**: Low - Rare for write to fail mid-stream
**Impact**: Medium - Corrupted/incomplete export file

**Mitigation**:
- ExportManager wraps entire write in try/except
- File handle properly closed on exception
- User shown error toast to indicate failure

**Testing Focus**: Unit test for exception handling

### OPS-001: Permission Denied on Target Directory

**Score: 2 (Low)**
**Probability**: Medium - Users may try to save to system directories
**Impact**: Low - Clear error message, user can retry elsewhere

**Mitigation**:
- ExportManager catches PermissionError
- Error toast displays clear message
- OS file dialog typically prevents selection of restricted locations

**Testing Focus**: Unit test for PermissionError handling

### OPS-002: Disk Full During Export

**Score: 2 (Low)**
**Probability**: Low - Uncommon scenario
**Impact**: Medium - Export fails with unclear error

**Mitigation**:
- ExportManager catches OSError
- Error toast displays message
- User retries after freeing space

**Testing Focus**: Mock OSError in unit test

## Minimal Risks

### TECH-001: Cross-Platform Path Handling

**Score: 1 (Minimal)**
**Probability**: Low - Using pathlib which handles cross-platform paths
**Impact**: Low - Minor inconvenience

**Mitigation**:
- Use `pathlib.Path` for all path operations
- OS file dialog returns platform-appropriate paths

**Testing Focus**: Covered by standard unit tests using tmp_path fixture

## Risk Distribution

### By Category
- Security: 1 risk (0 critical)
- Performance: 1 risk (0 critical)
- Data: 1 risk (0 critical)
- Technical: 1 risk (0 critical)
- Operational: 2 risks (0 critical)

### By Component
- Backend (ExportManager): 4 risks
- Frontend (Toast, Button): 0 risks
- Infrastructure: 2 risks

## Risk-Based Testing Strategy

### Priority 1: Medium Risk Tests
- Performance test for 100k row export < 2 seconds
- Validate pandas to_csv performance meets NFR

### Priority 2: Low Risk Tests
- Unit tests for ExportError exception handling
- Unit tests for special character handling in data
- Integration tests for export workflow

### Priority 3: Minimal Risk Tests
- Standard functional tests cover cross-platform paths

## Risk Acceptance Criteria

### Must Fix Before Production
- None (no critical or high risks)

### Can Deploy with Mitigation
- PERF-001: Validated by performance test
- SEC-001: Accepted - user's own data
- All others: Handled by error handling code

### Accepted Risks
- CSV injection (SEC-001): User's own data, not a security boundary

## Monitoring Requirements

Post-deployment monitoring for:
- Performance: Track export duration in logs (INFO level logging included)
- Errors: Monitor for ExportError frequency

## Quality Gate Impact

**Deterministic gate mapping:**
- No risk with score ≥ 9 → Not FAIL
- No risk with score ≥ 6 → Not CONCERNS
- **Gate: PASS**

## Integration with Quality Gates

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 0
    high: 0
    medium: 1
    low: 4
  highest:
    id: PERF-001
    score: 4
    title: 'Export exceeds 2s for 100k rows'
  recommendations:
    must_fix: []
    monitor:
      - 'Track export duration in logs'
```
