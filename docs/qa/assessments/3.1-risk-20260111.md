# Risk Profile: Story 3.1

Date: 2026-01-11
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 1
- Risk Score: 82/100 (Moderate Risk)

## High Risks Requiring Attention

### 1. TECH-001: Signal Loop from Bidirectional Sync

**Score: 6 (High)**

**Probability**: Medium (2) - The bidirectional sync pattern between Data Input tab and PnL Stats tab uses `blockSignals()` to prevent loops. This pattern is well-documented in Story 2.6 Dev Notes, but implementation errors are common when multiple signal connections exist.

**Impact**: High (3) - An infinite signal loop would freeze the UI completely, requiring application restart. Users would lose unsaved work.

**Affected Components**:
- `UserInputsPanel.inputs_changed` signal
- `AppState.adjustment_params_changed` signal
- `AdjustmentInputsPanel` (Data Input tab)

**Mitigation**:
- Strategy: Preventive
- Actions:
  - Strictly follow `blockSignals(True/False)` pattern from Story 2.6
  - Add guard flag to detect recursive signal emission
  - Code review focused on signal connection paths
- Testing Requirements:
  - Widget test: Rapid value changes between tabs
  - Widget test: Verify no signal emitted during programmatic updates
- Residual Risk: Low - Pattern is established and well-tested in existing codebase
- Owner: Dev
- Timeline: During implementation

## Risk Distribution

### By Category

- Technical: 4 risks (1 high)
- Data: 1 risk (0 high)
- Security: 0 risks
- Performance: 0 risks
- Business: 0 risks
- Operational: 1 risk (0 high)

### By Component

- UserInputsPanel: 3 risks
- AppState: 2 risks
- PnLStatsTab Layout: 1 risk

## Detailed Risk Register

| Risk ID | Category | Title | Probability | Impact | Score | Priority | Mitigation |
|---------|----------|-------|-------------|--------|-------|----------|------------|
| TECH-001 | Technical | Signal loop from bidirectional sync | Medium (2) | High (3) | 6 | High | blockSignals pattern + guard flag |
| TECH-002 | Technical | State inconsistency between tabs | Low (1) | Medium (2) | 2 | Low | Single source of truth in AppState |
| DATA-001 | Data | Validation bypass corrupts downstream | Low (1) | Medium (2) | 2 | Low | Validate in model + UI feedback |
| TECH-003 | Technical | Debounce timer race conditions | Low (1) | Low (1) | 1 | Minimal | Use setSingleShot pattern |
| OPS-001 | Operational | Theme styling inconsistency | Low (1) | Low (1) | 1 | Minimal | Reference constants.py |

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests (TECH-001)

- **Widget Test**: Change Stop Loss in PnL Stats tab, verify single signal emission
- **Widget Test**: Change Stop Loss in Data Input tab, verify PnL Stats updates without re-emitting
- **Widget Test**: Rapid alternating changes between tabs (stress test)
- **Unit Test**: `set_adjustment_params()` does not emit `inputs_changed` signal

### Priority 2: Medium Risk Tests (TECH-002, DATA-001)

- **Unit Test**: `MetricsUserInputs.validate()` rejects non-positive values
- **Widget Test**: Tab switch preserves all input values via AppState
- **Widget Test**: Invalid input shows error border (SIGNAL_CORAL)

### Priority 3: Low Risk Tests (TECH-003, OPS-001)

- **Unit Test**: Debounce timer coalesces rapid changes
- **Manual**: Visual inspection of styling against Observatory theme

## Risk Acceptance Criteria

### Must Fix Before Production

- All signal loop issues (TECH-001)

### Can Deploy with Mitigation

- State inconsistency with monitoring (TECH-002)
- Validation bypass if downstream has defensive checks (DATA-001)

### Accepted Risks

- Minor debounce timing variations (TECH-003)
- Minor styling deviations (OPS-001)

## Monitoring Requirements

Post-deployment monitoring for:

- Error logs for any signal-related exceptions
- UI freeze reports from users
- Metric calculation anomalies (would indicate DATA-001)

## Risk Review Triggers

Review and update risk profile when:

- Additional signals added to UserInputsPanel
- New tabs connect to adjustment_params
- MetricsUserInputs fields change
- Downstream metric calculations implemented (Stories 3.2-3.6)
