# Test Design: Story 1.1

Date: 2026-01-09
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 14
- Unit tests: 5 (36%)
- Integration tests: 4 (29%)
- Widget tests: 4 (29%)
- E2E tests: 1 (7%)
- Priority distribution: P0: 9, P1: 4, P2: 1

## Test Level Rationale

For a scaffolding story, the test strategy emphasizes:
1. **Unit tests** for dependency import verification (fast, fail-fast feedback)
2. **Integration tests** for file system structure validation
3. **Widget tests** for Qt component verification using pytest-qt
4. **E2E test** for complete application launch validation

## Test Scenarios by Acceptance Criteria

### AC1: Project initialized with `uv` and `pyproject.toml` configuration

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-001 | Integration | P0 | Verify pyproject.toml exists with correct metadata (name, version, requires-python) | File system + content validation |
| 1.1-INT-002 | Integration | P1 | Verify tool configurations present (black, ruff, mypy, pytest) | File system + TOML parsing |

**Test Details:**

```python
# 1.1-INT-001: tests/integration/test_project_setup.py
def test_pyproject_toml_metadata():
    """Verify pyproject.toml has required project metadata."""
    import tomllib
    from pathlib import Path

    pyproject = Path("pyproject.toml")
    assert pyproject.exists(), "pyproject.toml must exist"

    with open(pyproject, "rb") as f:
        data = tomllib.load(f)

    assert data["project"]["name"] == "lumen"
    assert data["project"]["version"] == "1.0.0"
    assert data["project"]["requires-python"] == ">=3.11"
```

---

### AC2: Directory structure created per Technical Assumptions

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-003 | Integration | P1 | Verify all required directories exist | File system structure validation |
| 1.1-INT-004 | Integration | P1 | Verify __init__.py files in all packages | Python package structure |

**Test Details:**

```python
# 1.1-INT-003: tests/integration/test_project_setup.py
def test_directory_structure():
    """Verify required project directories exist."""
    from pathlib import Path

    required_dirs = [
        "src",
        "src/core",
        "src/ui",
        "src/ui/components",
        "src/tabs",
        "tests",
        "tests/unit",
        "tests/widget",
        "tests/integration",
        "assets/fonts",
        ".lumen_cache",
    ]

    for dir_path in required_dirs:
        assert Path(dir_path).is_dir(), f"Directory {dir_path} must exist"
```

---

### AC3: Core dependencies installed: PyQt6, pandas, pyarrow, pyqtgraph, openpyxl

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-UNIT-001 | Unit | P0 | Verify PyQt6 import succeeds | Dependency availability |
| 1.1-UNIT-002 | Unit | P0 | Verify pandas import succeeds | Dependency availability |
| 1.1-UNIT-003 | Unit | P0 | Verify pyarrow import succeeds | Dependency availability |
| 1.1-UNIT-004 | Unit | P0 | Verify pyqtgraph import succeeds | Dependency availability |
| 1.1-UNIT-005 | Unit | P0 | Verify openpyxl import succeeds | Dependency availability |

**Test Details:**

```python
# 1.1-UNIT-001 through 1.1-UNIT-005: tests/unit/test_dependencies.py
import pytest

@pytest.mark.parametrize("module_name", [
    "PyQt6",
    "pandas",
    "pyarrow",
    "pyqtgraph",
    "openpyxl",
])
def test_core_dependency_import(module_name):
    """Verify core dependencies can be imported."""
    import importlib
    module = importlib.import_module(module_name)
    assert module is not None
```

---

### AC4: `main.py` entry point creates basic `QApplication` and `QMainWindow`

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-WIDGET-001 | Widget | P0 | Verify MainWindow can be instantiated | Qt component creation |
| 1.1-WIDGET-002 | Widget | P0 | Verify QApplication creation | Qt framework initialization |

**Test Details:**

```python
# 1.1-WIDGET-001: tests/widget/test_main_window.py
import pytest

@pytest.mark.widget
def test_main_window_instantiation(qtbot):
    """Verify MainWindow can be instantiated."""
    from src.main import MainWindow

    window = MainWindow()
    qtbot.addWidget(window)

    assert window is not None

@pytest.mark.widget
def test_qapplication_available(qapp):
    """Verify QApplication is available via pytest-qt."""
    from PyQt6.QtWidgets import QApplication

    assert QApplication.instance() is not None
```

---

### AC5: Application runs without errors via `uv run python src/main.py`

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-E2E-001 | E2E | P0 | Execute application startup and verify no crash | Complete workflow validation |

**Test Details:**

```python
# 1.1-E2E-001: tests/integration/test_app_launch.py
import subprocess
import sys

def test_application_launches_without_error():
    """Verify application can start without errors."""
    # Start app and immediately close (timeout ensures we don't hang)
    result = subprocess.run(
        [sys.executable, "-c",
         "from src.main import main; import sys; sys.exit(0)"],
        capture_output=True,
        timeout=10,
    )
    assert result.returncode == 0, f"App failed: {result.stderr.decode()}"
```

---

### AC6: Window appears with title "Lumen" and minimum size 1280x720

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-WIDGET-003 | Widget | P1 | Verify window title is "Lumen" | UI requirement validation |
| 1.1-WIDGET-004 | Widget | P1 | Verify minimum size is 1280x720 | UI requirement validation |

**Test Details:**

```python
# 1.1-WIDGET-003 and 1.1-WIDGET-004: tests/widget/test_main_window.py
@pytest.mark.widget
def test_main_window_title(qtbot):
    """Verify window title is 'Lumen'."""
    from src.main import MainWindow

    window = MainWindow()
    qtbot.addWidget(window)

    assert window.windowTitle() == "Lumen"

@pytest.mark.widget
def test_main_window_minimum_size(qtbot):
    """Verify minimum window size is 1280x720."""
    from src.main import MainWindow

    window = MainWindow()
    qtbot.addWidget(window)

    min_size = window.minimumSize()
    assert min_size.width() == 1280
    assert min_size.height() == 720
```

---

### AC7: `.gitignore` configured for Python, PyQt, and `.lumen_cache/`

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.1-INT-005 | Integration | P2 | Verify .gitignore contains required patterns | Configuration validation |

**Test Details:**

```python
# 1.1-INT-005: tests/integration/test_project_setup.py
def test_gitignore_configuration():
    """Verify .gitignore contains required patterns."""
    from pathlib import Path

    gitignore = Path(".gitignore")
    assert gitignore.exists(), ".gitignore must exist"

    content = gitignore.read_text()

    required_patterns = [
        "__pycache__",
        "*.pyc",
        ".venv",
        ".lumen_cache",
        ".pytest_cache",
        ".mypy_cache",
    ]

    for pattern in required_patterns:
        assert pattern in content, f".gitignore must include {pattern}"
```

---

## Risk Coverage

| Risk ID | Test IDs | Coverage |
|---------|----------|----------|
| TECH-001 | 1.1-UNIT-001 to 1.1-UNIT-005 | Full - all dependencies tested |
| TECH-002 | 1.1-E2E-001 | Partial - launch verified |
| TECH-003 | Manual verification | Tooling runs during CI |
| OPS-001 | Manual verification | Makefile targets tested manually |
| BUS-001 | 1.1-INT-003, 1.1-INT-004 | Full - structure validated |
| SEC-001 | 1.1-INT-005 | Full - gitignore validated |

## Recommended Execution Order

1. **P0 Unit tests** (1.1-UNIT-001 to 005) - Fail fast on dependency issues
2. **P0 Widget tests** (1.1-WIDGET-001, 002) - Verify Qt setup
3. **P0 E2E test** (1.1-E2E-001) - Verify complete launch
4. **P1 Integration tests** (1.1-INT-001 to 004) - Structure validation
5. **P1 Widget tests** (1.1-WIDGET-003, 004) - Window properties
6. **P2 Integration test** (1.1-INT-005) - Gitignore verification

## Test File Locations

```
tests/
├── unit/
│   └── test_dependencies.py      # 1.1-UNIT-001 to 005
├── widget/
│   └── test_main_window.py       # 1.1-WIDGET-001 to 004
└── integration/
    ├── test_project_setup.py     # 1.1-INT-001 to 005
    └── test_app_launch.py        # 1.1-E2E-001
```

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent

## Notes for Implementation

1. **pytest-qt fixture**: Widget tests require the `qtbot` fixture from pytest-qt
2. **Import paths**: Tests import from `src.main` assuming proper Python path setup
3. **Subprocess test**: E2E test uses subprocess to avoid Qt application conflicts
4. **Markers**: Widget tests use `@pytest.mark.widget` for selective execution
