# Test Design: Story 3.1

Date: 2026-01-11
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 23
- Unit tests: 12 (52%)
- Integration tests: 0 (0%)
- Widget tests: 9 (39%)
- E2E tests: 0 (0%)
- Manual tests: 2 (9%)
- Priority distribution: P0: 4, P1: 13, P2: 6

## Test Scenarios by Acceptance Criteria

### AC1: Tab layout (top/middle/bottom)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-WIDGET-001 | Widget | P1 | Verify three-section layout exists (top, middle, bottom) | Validates visual structure |
| 3.1-WIDGET-002 | Widget | P1 | UserInputsPanel is in top section with fixed ~120px height | Layout correctness |
| 3.1-WIDGET-003 | Widget | P2 | Middle section uses QFrame placeholder and stretches | Layout behavior |
| 3.1-WIDGET-004 | Widget | P2 | Bottom section uses QFrame placeholder with fixed ~200px height | Layout behavior |

### AC2: User inputs (5 spinboxes)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-UNIT-001 | Unit | P1 | MetricsUserInputs default values are correct | Pure data validation |
| 3.1-UNIT-002 | Unit | P1 | MetricsUserInputs.validate() rejects non-positive flat_stake | Business logic |
| 3.1-UNIT-003 | Unit | P1 | MetricsUserInputs.validate() rejects non-positive starting_capital | Business logic |
| 3.1-UNIT-004 | Unit | P1 | MetricsUserInputs.validate() rejects fractional_kelly outside 1-100 | Business logic |
| 3.1-UNIT-005 | Unit | P1 | MetricsUserInputs.to_dict() serializes correctly | Persistence logic |
| 3.1-UNIT-006 | Unit | P1 | MetricsUserInputs.from_dict() deserializes correctly | Persistence logic |
| 3.1-UNIT-007 | Unit | P1 | flat_stake_spin has range 1-1,000,000, default 1000, step 100 | Configuration |
| 3.1-UNIT-008 | Unit | P1 | starting_capital_spin has range 1-10,000,000, default 10000, step 1000 | Configuration |
| 3.1-UNIT-009 | Unit | P1 | fractional_kelly_spin has range 1-100, default 25, step 5 | Configuration |
| 3.1-UNIT-010 | Unit | P2 | stop_loss_spin has range 0.1-100, default 8, step 0.5 | Configuration |
| 3.1-UNIT-011 | Unit | P2 | efficiency_spin has range 0-100, default 5, step 0.5 | Configuration |

### AC3: Bidirectional sync with Data Input tab

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-WIDGET-005 | Widget | P0 | Change stop_loss in PnL Stats tab updates AppState.adjustment_params | Critical sync path |
| 3.1-WIDGET-006 | Widget | P0 | AppState.adjustment_params change updates PnL Stats tab stop_loss | Critical sync path |
| 3.1-WIDGET-007 | Widget | P0 | set_adjustment_params() updates UI without emitting inputs_changed signal | Loop prevention |
| 3.1-WIDGET-008 | Widget | P1 | Change efficiency in PnL Stats tab updates AppState.adjustment_params | Sync completeness |

### AC4: Input validation with feedback

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-UNIT-012 | Unit | P1 | Invalid input shows error border (SIGNAL_CORAL color) | User feedback |

### AC5: Inputs persist across tab switches

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-WIDGET-009 | Widget | P0 | Input values persist via AppState after simulated tab switch | State management |

### AC6: Apply with debounce

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-UNIT-013 | Unit | P2 | inputs_changed signal emits with 150ms debounce | Performance |
| 3.1-UNIT-014 | Unit | P2 | Multiple rapid changes result in single signal emission | Debounce correctness |

### Manual Verification (AC 1-6)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 3.1-MANUAL-001 | Manual | P1 | Visual verification of tab layout and styling | Cannot automate visual |
| 3.1-MANUAL-002 | Manual | P1 | E2E sync test: change Data Input tab, verify PnL Stats | Full integration |

## Risk Coverage

| Risk ID | Score | Mitigated By |
|---------|-------|--------------|
| TECH-001 (Signal Loop) | 6 | 3.1-WIDGET-005, 3.1-WIDGET-006, 3.1-WIDGET-007, 3.1-WIDGET-008 |
| TECH-002 (State Inconsistency) | 2 | 3.1-WIDGET-009 |
| DATA-001 (Validation Bypass) | 2 | 3.1-UNIT-002, 3.1-UNIT-003, 3.1-UNIT-004, 3.1-UNIT-012 |
| TECH-003 (Debounce Race) | 1 | 3.1-UNIT-013, 3.1-UNIT-014 |
| OPS-001 (Theme Styling) | 1 | 3.1-MANUAL-001 |

## Recommended Execution Order

1. **P0 Unit tests** - Fail fast on core logic
   - MetricsUserInputs validation tests
2. **P0 Widget tests** - Critical sync paths
   - 3.1-WIDGET-005 through 3.1-WIDGET-009
3. **P1 Unit tests** - Configuration and serialization
4. **P1 Widget tests** - Layout structure
5. **P1 Manual tests** - Visual and E2E verification
6. **P2 tests** - Debounce and secondary spinbox configs

## Test File Mapping

| Test File | Test IDs | Framework |
|-----------|----------|-----------|
| `tests/unit/test_models.py` | 3.1-UNIT-001 to 3.1-UNIT-006 | pytest |
| `tests/unit/test_user_inputs_panel.py` | 3.1-UNIT-007 to 3.1-UNIT-014 | pytest + pytest-qt |
| `tests/widget/test_pnl_stats.py` | 3.1-WIDGET-001 to 3.1-WIDGET-009 | pytest-qt |

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (unit for logic, widget for Qt interactions)
- [x] No duplicate coverage across levels
- [x] Priorities align with risk assessment (P0 for TECH-001 mitigations)
- [x] Test IDs follow naming convention (3.1-LEVEL-SEQ)
- [x] Scenarios are atomic and independent
