# Test Design: Story 1.2 - Themed Application Shell

Date: 2026-01-09
Designer: Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios:** 18
- **Unit tests:** 7 (39%)
- **Widget tests:** 11 (61%)
- **E2E tests:** 0 (0%)
- **Priority distribution:** P0: 4, P1: 10, P2: 4

### Level Justification

This story is purely UI-focused with no external integrations, database operations, or complex user workflows. Therefore:

- **Unit tests** for pure functions (stylesheet generation, font loading logic)
- **Widget tests** for verifying Qt component configuration and behavior
- **No E2E tests** - no cross-component user journeys to validate; widget tests provide sufficient coverage

---

## Test Scenarios by Acceptance Criteria

### AC1: QTabWidget with 4 tabs

**Requirement:** `QTabWidget` with 4 tabs: "Data Input", "Feature Explorer", "PnL & Trading Stats", "Monte Carlo"

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-001 | Widget | P0 | MainWindow contains QTabWidget with exactly 4 tabs | Core UI structure - must have correct tab count |
| 1.2-WIDGET-002 | Widget | P0 | Tab titles match expected names exactly | Tabs must be identifiable by name |

**Test Implementation:**
```python
# tests/widget/test_main_window.py
def test_main_window_has_four_tabs(qtbot):
    """MainWindow contains exactly 4 tabs."""
    from src.ui.main_window import MainWindow
    window = MainWindow()
    qtbot.addWidget(window)
    assert window.tab_widget.count() == 4

def test_tab_titles_match_expected_names(qtbot):
    """Tab titles match workflow order."""
    from src.ui.main_window import MainWindow
    window = MainWindow()
    qtbot.addWidget(window)
    expected = ["Data Input", "Feature Explorer", "PnL & Trading Stats", "Monte Carlo"]
    for i, title in enumerate(expected):
        assert window.tab_widget.tabText(i) == title
```

---

### AC2: Tab order and behavior

**Requirement:** Tab order matches workflow; tabs not closable or movable

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-003 | Widget | P0 | Tabs are not closable | User cannot accidentally close tabs |
| 1.2-WIDGET-004 | Widget | P0 | Tabs are not movable | Workflow order must be preserved |

**Test Implementation:**
```python
# tests/widget/test_main_window.py
def test_tabs_not_closable(qtbot):
    """Tabs cannot be closed by user."""
    from src.ui.main_window import MainWindow
    window = MainWindow()
    qtbot.addWidget(window)
    assert window.tab_widget.tabsClosable() is False

def test_tabs_not_movable(qtbot):
    """Tabs cannot be reordered by user."""
    from src.ui.main_window import MainWindow
    window = MainWindow()
    qtbot.addWidget(window)
    assert window.tab_widget.isMovable() is False
```

---

### AC3: Monte Carlo placeholder

**Requirement:** Monte Carlo tab displays centered message: "Monte Carlo simulations coming in Phase 3" with dimmed/disabled appearance

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-005 | Widget | P1 | Monte Carlo tab contains Phase 3 message | User understands feature is planned |
| 1.2-WIDGET-006 | Widget | P2 | Placeholder message uses TEXT_DISABLED color | Visual consistency with disabled state |

**Test Implementation:**
```python
# tests/widget/test_tabs.py
def test_monte_carlo_shows_placeholder_message(qtbot):
    """Monte Carlo tab shows Phase 3 message."""
    from src.tabs.monte_carlo import MonteCarloTab
    from PyQt6.QtWidgets import QLabel
    tab = MonteCarloTab()
    qtbot.addWidget(tab)
    labels = tab.findChildren(QLabel)
    assert any("Phase 3" in label.text() for label in labels)

def test_monte_carlo_placeholder_is_dimmed(qtbot):
    """Placeholder uses TEXT_DISABLED color styling."""
    from src.tabs.monte_carlo import MonteCarloTab
    from src.ui.constants import Colors
    from PyQt6.QtWidgets import QLabel
    tab = MonteCarloTab()
    qtbot.addWidget(tab)
    labels = tab.findChildren(QLabel)
    placeholder = next(l for l in labels if "Phase 3" in l.text())
    # Check styleSheet contains disabled color
    assert Colors.TEXT_DISABLED.lower() in placeholder.styleSheet().lower()
```

---

### AC4: Observatory color palette as QSS

**Requirement:** Observatory color palette implemented as QSS stylesheet

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-001 | Unit | P1 | get_stylesheet() returns non-empty string | Stylesheet must exist |
| 1.2-UNIT-002 | Unit | P1 | Stylesheet contains BG_BASE color | Primary background color present |
| 1.2-UNIT-003 | Unit | P1 | Stylesheet contains BG_SURFACE color | Surface color present |
| 1.2-UNIT-004 | Unit | P1 | Stylesheet contains SIGNAL_CYAN color | Accent color present |

**Test Implementation:**
```python
# tests/unit/test_theme.py
def test_get_stylesheet_returns_nonempty_string():
    """Stylesheet function returns non-empty string."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert isinstance(stylesheet, str)
    assert len(stylesheet) > 0

def test_stylesheet_contains_bg_base():
    """Stylesheet includes BG_BASE background color."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "#0C0C12" in stylesheet.upper() or "#0c0c12" in stylesheet.lower()

def test_stylesheet_contains_bg_surface():
    """Stylesheet includes BG_SURFACE color."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "#141420" in stylesheet.upper() or "#141420" in stylesheet.lower()

def test_stylesheet_contains_signal_cyan():
    """Stylesheet includes SIGNAL_CYAN accent color."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "#00FFD4" in stylesheet.upper() or "#00ffd4" in stylesheet.lower()
```

---

### AC5: Font loading

**Requirement:** Fonts loaded from `assets/fonts/`: Azeret Mono, Geist

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-005 | Unit | P1 | load_fonts() function exists and returns bool | Font loading must report success/failure |
| 1.2-UNIT-006 | Unit | P2 | load_fonts() handles missing font directory gracefully | Must not crash if fonts unavailable |

**Test Implementation:**
```python
# tests/unit/test_theme.py
def test_load_fonts_returns_bool(qapp):
    """Font loading function returns boolean status."""
    from src.ui.theme import load_fonts
    result = load_fonts(qapp)
    assert isinstance(result, bool)

def test_load_fonts_handles_missing_directory(qapp, tmp_path, monkeypatch):
    """Font loading handles missing directory gracefully."""
    from src.ui import theme
    # Monkeypatch to use non-existent directory
    monkeypatch.setattr(theme, 'FONT_DIR', tmp_path / 'nonexistent')
    result = theme.load_fonts(qapp)
    # Should return False but not raise exception
    assert result is False or result is True  # Doesn't crash
```

---

### AC6: Main window background

**Requirement:** Main window background uses BG_BASE (#0C0C12)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-UNIT-007 | Unit | P1 | Stylesheet contains QMainWindow with BG_BASE | Main window styling present |

**Test Implementation:**
```python
# tests/unit/test_theme.py
def test_stylesheet_styles_main_window():
    """Stylesheet includes QMainWindow background styling."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "QMainWindow" in stylesheet
    # BG_BASE should be associated with main window
    assert "#0C0C12" in stylesheet or "#0c0c12" in stylesheet
```

---

### AC7: Tab content areas background

**Requirement:** Tab content areas use BG_SURFACE (#141420)

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-007 | Widget | P1 | QTabWidget pane styled with BG_SURFACE | Tab content has correct background |

**Test Implementation:**
```python
# tests/unit/test_theme.py (stylesheet contains the styling)
def test_stylesheet_styles_tab_pane():
    """Stylesheet includes QTabWidget::pane styling."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "QTabWidget::pane" in stylesheet
```

---

### AC8: Tab bar styling

**Requirement:** Tab bar styled with TEXT_SECONDARY background, TEXT_PRIMARY text

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-008 | Widget | P1 | QTabBar styling present in stylesheet | Tab bar has correct colors |

**Test Implementation:**
```python
# tests/unit/test_theme.py
def test_stylesheet_styles_tab_bar():
    """Stylesheet includes QTabBar::tab styling."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "QTabBar::tab" in stylesheet
```

---

### AC9: Active tab visual distinction

**Requirement:** Active tab visually distinguished with accent border

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-009 | Widget | P1 | Selected tab styling with SIGNAL_CYAN present | Active tab is distinguishable |

**Test Implementation:**
```python
# tests/unit/test_theme.py
def test_stylesheet_styles_selected_tab():
    """Stylesheet includes QTabBar::tab:selected styling with accent."""
    from src.ui.theme import get_stylesheet
    stylesheet = get_stylesheet()
    assert "QTabBar::tab:selected" in stylesheet
    # Should contain accent color for border
    assert "#00FFD4" in stylesheet.upper() or "#00ffd4" in stylesheet.lower()
```

---

### AC10: Theme module reusability

**Requirement:** Theme loading extracted to `src/ui/theme.py` for reuse

| ID | Level | Priority | Test | Justification |
|----|-------|----------|------|---------------|
| 1.2-WIDGET-010 | Widget | P2 | apply_theme() function exists and applies styling | Single entry point for theming |
| 1.2-WIDGET-011 | Widget | P2 | Theme can be applied to QApplication | Theme is reusable |

**Test Implementation:**
```python
# tests/unit/test_theme.py
def test_apply_theme_function_exists():
    """Theme module provides apply_theme entry point."""
    from src.ui.theme import apply_theme
    assert callable(apply_theme)

def test_apply_theme_accepts_qapplication(qapp):
    """apply_theme can be called with QApplication."""
    from src.ui.theme import apply_theme
    # Should not raise
    apply_theme(qapp)
```

---

## Risk Coverage

| Risk ID | Mitigated By Tests |
|---------|-------------------|
| TECH-001 | 1.2-UNIT-005, 1.2-UNIT-006 |
| TECH-002 | 1.2-UNIT-001, 1.2-UNIT-002, 1.2-UNIT-003, 1.2-UNIT-004 |
| TECH-003 | All widget tests verify actual Qt behavior |

---

## Test Summary Table

| ID | Level | Priority | AC | Test Description |
|----|-------|----------|-----|------------------|
| 1.2-WIDGET-001 | Widget | P0 | 1 | MainWindow has 4 tabs |
| 1.2-WIDGET-002 | Widget | P0 | 1 | Tab titles match expected names |
| 1.2-WIDGET-003 | Widget | P0 | 2 | Tabs not closable |
| 1.2-WIDGET-004 | Widget | P0 | 2 | Tabs not movable |
| 1.2-WIDGET-005 | Widget | P1 | 3 | Monte Carlo shows Phase 3 message |
| 1.2-WIDGET-006 | Widget | P2 | 3 | Placeholder uses TEXT_DISABLED |
| 1.2-UNIT-001 | Unit | P1 | 4 | get_stylesheet() returns string |
| 1.2-UNIT-002 | Unit | P1 | 4 | Stylesheet contains BG_BASE |
| 1.2-UNIT-003 | Unit | P1 | 4 | Stylesheet contains BG_SURFACE |
| 1.2-UNIT-004 | Unit | P1 | 4 | Stylesheet contains SIGNAL_CYAN |
| 1.2-UNIT-005 | Unit | P1 | 5 | load_fonts() returns bool |
| 1.2-UNIT-006 | Unit | P2 | 5 | load_fonts() handles missing dir |
| 1.2-UNIT-007 | Unit | P1 | 6 | Stylesheet styles QMainWindow |
| 1.2-WIDGET-007 | Widget | P1 | 7 | Stylesheet styles tab pane |
| 1.2-WIDGET-008 | Widget | P1 | 8 | Stylesheet styles tab bar |
| 1.2-WIDGET-009 | Widget | P1 | 9 | Selected tab has accent styling |
| 1.2-WIDGET-010 | Widget | P2 | 10 | apply_theme() exists |
| 1.2-WIDGET-011 | Widget | P2 | 10 | Theme applies to QApplication |

---

## Recommended Execution Order

1. **P0 Widget tests** (fail fast on core structure)
   - 1.2-WIDGET-001 through 1.2-WIDGET-004
2. **P1 Unit tests** (validate theme module)
   - 1.2-UNIT-001 through 1.2-UNIT-007
3. **P1 Widget tests** (verify visual elements)
   - 1.2-WIDGET-005, 1.2-WIDGET-007 through 1.2-WIDGET-009
4. **P2 tests** (secondary validation)
   - Remaining tests as time permits

---

## Quality Checklist

- [x] Every AC has at least one test
- [x] Test levels are appropriate (unit for pure functions, widget for Qt components)
- [x] No duplicate coverage across levels
- [x] Critical paths (tab structure) have P0 priority
- [x] Risk mitigations are addressed (TECH-001, TECH-002)
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent

---

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 18
  by_level:
    unit: 7
    widget: 11
    e2e: 0
  by_priority:
    p0: 4
    p1: 10
    p2: 4
  coverage_gaps: []
```

---

Test design matrix: docs/qa/assessments/1.2-test-design-20260109.md
P0 tests identified: 4
