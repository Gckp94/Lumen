# Risk Profile: Story 6.3

Date: 2026-01-13
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 8
- Critical Risks: 0
- High Risks: 1
- Risk Score: 74/100 (Moderate Risk)

## High Risk Requiring Attention

### 1. [TECH-003]: Column Not Found in Current Dataset

**Score: 6 (High)**
**Probability**: High (3) - Users will commonly load configurations saved from different datasets with different columns. This is expected workflow when switching between trade data files.
**Impact**: Medium (2) - Configuration becomes unusable for current dataset, causing user confusion and wasted time.

**Mitigation**:
- Validate column existence during load before applying config
- Show informative error message listing available columns
- Consider partial application (bins + metric only)

**Testing Focus**: Test loading config with non-existent column name

## Risk Distribution

### By Category
- Technical (TECH): 3 risks (1 high)
- Data (DATA): 3 risks (0 high)
- Business (BUS): 1 risk (0 high)
- Operational (OPS): 1 risk (0 high)
- Security (SEC): 0 risks
- Performance (PERF): 0 risks

### By Component
- Frontend (DataBinningTab): 4 risks
- Core (BinConfig model): 2 risks
- File System: 2 risks

## Detailed Risk Register

| Risk ID   | Description                              | Probability | Impact     | Score | Priority |
|-----------|------------------------------------------|-------------|------------|-------|----------|
| TECH-003  | Column not found in current dataset      | High (3)    | Medium (2) | 6     | High     |
| DATA-001  | Invalid JSON crashes during load         | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-001  | UI state mismatch after config load      | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-002  | Configuration file corruption on save    | Low (1)     | High (3)   | 3     | Low      |
| BUS-001   | Directory memory lost between sessions   | High (3)    | Low (1)    | 3     | Low      |
| TECH-002  | BinConfig validation fails silently      | Low (1)     | Medium (2) | 2     | Low      |
| OPS-001   | File permission errors during save/load  | Low (1)     | Low (1)    | 1     | Minimal  |
| DATA-003  | Metric column mismatch in config         | Low (1)     | Low (1)    | 1     | Minimal  |

## Risk Mitigation Strategies

### TECH-003: Column Not Found
```yaml
mitigation:
  risk_id: 'TECH-003'
  strategy: 'preventive'
  actions:
    - 'Check column existence before applying config'
    - 'Show error toast with available column names'
    - 'Log warning but do not crash'
  testing_requirements:
    - 'Unit test: validate() catches invalid column for dataset'
    - 'Widget test: loading config with missing column shows toast'
  residual_risk: 'Low - User must manually select correct column'
  owner: 'dev'
  timeline: 'Implementation'
```

### DATA-001: Invalid JSON
```yaml
mitigation:
  risk_id: 'DATA-001'
  strategy: 'detective'
  actions:
    - 'Wrap JSON parsing in try/except'
    - 'Call BinConfig.validate() after deserialization'
    - 'Show specific error message via Toast.show_error()'
  testing_requirements:
    - 'Unit test: from_dict raises KeyError for missing fields'
    - 'Unit test: from_dict raises TypeError for invalid types'
    - 'Widget test: loading malformed JSON shows error toast'
  residual_risk: 'Minimal - All error paths handled'
  owner: 'dev'
  timeline: 'Implementation'
```

### TECH-001: UI State Mismatch
```yaml
mitigation:
  risk_id: 'TECH-001'
  strategy: 'preventive'
  actions:
    - 'Clear existing state before applying config'
    - 'Set UI elements in deterministic order: column, bins, metric'
    - 'Emit bin_config_changed signal after all UI updated'
  testing_requirements:
    - 'Widget test: _apply_config sets column dropdown correctly'
    - 'Widget test: _apply_config creates correct bin rows'
    - 'Widget test: _apply_config sets metric toggle correctly'
    - 'Widget test: signal emits after load completes'
  residual_risk: 'Low - Sequential UI update prevents race conditions'
  owner: 'dev'
  timeline: 'Implementation'
```

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests
- **TECH-003**: Load config with column not in current DataFrame
- **TECH-003**: Verify error toast shown with column mismatch
- **DATA-001**: Load malformed JSON file
- **DATA-001**: Load JSON with missing required fields

### Priority 2: Medium Risk Tests
- **TECH-001**: Verify complete UI state after load
- **TECH-001**: Verify signal emission timing
- **DATA-001**: Test BinConfig.from_dict() error handling

### Priority 3: Low/Minimal Risk Tests
- **DATA-002**: Test successful save produces valid JSON
- **BUS-001**: Verify directory memory within session
- **TECH-002**: Test validate() catches all error cases
- **OPS-001**: Handled by QFileDialog (no explicit test needed)

## Risk Acceptance Criteria

### Must Fix Before Production
- TECH-003: Column validation on load (score 6)

### Can Deploy with Mitigation
- DATA-001: JSON error handling (score 4) - compensated by try/except
- TECH-001: UI state sync (score 4) - compensated by sequential updates

### Accepted Risks
- BUS-001: Session-scoped directory memory is by design (AC7)
- OPS-001: File permission errors handled by OS dialogs
- DATA-003: Metric column defaults to adjusted_gain_pct

## Monitoring Requirements

Post-deployment monitoring for:
- Error toast frequency (indicates problematic configs)
- Load vs Save usage ratio (user workflow insights)
- Column mismatch errors (may indicate need for column mapping)

## Risk Review Triggers

Review and update risk profile when:
- Adding new fields to BinConfig
- Supporting multiple config formats
- Cross-session directory persistence added
- Import/export from external tools

---
Risk profile: docs/qa/assessments/6.3-risk-20260113.md
