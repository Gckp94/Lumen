# Risk Profile: Story 2.1

Date: 2026-01-10
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 9
- Critical Risks: 0
- High Risks: 2
- Risk Score: 76/100 (calculated)

This story involves building a new visualization component using PyQtGraph with OpenGL acceleration. The primary risks center on performance requirements (83k+ points, <200ms updates) and cross-platform OpenGL compatibility. No critical risks were identified, but two high-priority performance risks require mitigation.

## Risk Matrix

| Risk ID   | Description                           | Probability | Impact     | Score | Priority |
|-----------|---------------------------------------|-------------|------------|-------|----------|
| PERF-001  | 83k+ point rendering performance      | Medium (2)  | High (3)   | 6     | High     |
| PERF-002  | Column change < 200ms requirement     | Medium (2)  | High (3)   | 6     | High     |
| TECH-001  | OpenGL compatibility across systems   | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-002  | AppState signal integration errors    | Low (1)     | Medium (2) | 2     | Low      |
| DATA-001  | NaN/Inf values in numeric columns     | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-002  | Zero numeric columns edge case        | Low (1)     | Low (1)    | 1     | Minimal  |
| PERF-003  | Memory consumption with large datasets| Low (1)     | Medium (2) | 2     | Low      |
| OPS-001   | OpenGL driver dependencies            | Low (1)     | Medium (2) | 2     | Low      |
| TECH-003  | QSplitter resize edge cases           | Low (1)     | Low (1)    | 1     | Minimal  |

## High Risks Requiring Attention

### 1. PERF-001: 83k+ Point Rendering Performance

**Score: 6 (High)**
**Probability**: Medium - PyQtGraph with OpenGL can handle 100k+ points, but configuration matters
**Impact**: High - Core AC requirement; failure would render feature unusable

**Mitigation**:
- Enable OpenGL rendering: `pg.setConfigOptions(useOpenGL=True)`
- Disable anti-aliasing: `antialias=False`
- Use `ScatterPlotItem` with `size=3, pen=None` for optimal performance
- Pre-validate with 100k+ point test before story completion

**Testing Focus**:
- Load test with 100k synthetic points
- Measure render time and frame rate
- Test on systems with different GPU capabilities

### 2. PERF-002: Column Change Response Time < 200ms

**Score: 6 (High)**
**Probability**: Medium - Depends on scatter plot update implementation
**Impact**: High - UX degradation if not met; explicit AC requirement

**Mitigation**:
- Implement debounce (150ms per Animation.DEBOUNCE_INPUT)
- Use `setData()` method for batch updates rather than individual point updates
- Profile column change operation end-to-end

**Testing Focus**:
- Time column selector change to chart update completion
- Test with various dataset sizes (1k, 10k, 50k, 83k, 100k)
- Automated performance test with timing assertions

## Medium Risks

### TECH-001: OpenGL Compatibility Across Systems

**Score: 4 (Medium)**
**Probability**: Medium - Some systems have outdated/missing OpenGL support
**Impact**: Medium - Fallback to software rendering is possible but slower

**Mitigation**:
- Test on multiple systems (Intel integrated, NVIDIA, AMD)
- Implement graceful fallback if OpenGL unavailable
- Add `render_failed` signal for error handling

### DATA-001: NaN/Inf Values in Numeric Columns

**Score: 4 (Medium)**
**Probability**: Medium - Real trading data often has missing values
**Impact**: Medium - PyQtGraph may behave unexpectedly with NaN/Inf

**Mitigation**:
- Filter out NaN/Inf values before plotting
- Display warning in bottom bar if data points were excluded
- Document behavior in UI

## Low Risks

### TECH-002: AppState Signal Integration

**Score: 2 (Low)**
**Probability**: Low - AppState signals are well-defined and tested in previous stories
**Impact**: Medium - Incorrect integration would break data flow

**Mitigation**:
- Follow established signal connection patterns from DataInputTab
- Comprehensive widget tests verifying signal handling

### PERF-003: Memory Consumption

**Score: 2 (Low)**
**Probability**: Low - PyQtGraph handles memory efficiently
**Impact**: Medium - Could cause crashes with very large datasets

**Mitigation**:
- Monitor memory during large dataset testing
- ScatterPlotItem uses NumPy arrays efficiently

### OPS-001: OpenGL Driver Dependencies

**Score: 2 (Low)**
**Probability**: Low - Most modern systems have OpenGL support
**Impact**: Medium - Would affect chart performance

**Mitigation**:
- Document minimum OpenGL version requirements
- Test fallback behavior

## Minimal Risks

### DATA-002: Zero Numeric Columns Edge Case

**Score: 1 (Minimal)**
**Probability**: Low - Data Input tab already validates data structure
**Impact**: Low - Cosmetic issue, show empty state message

### TECH-003: QSplitter Resize Edge Cases

**Score: 1 (Minimal)**
**Probability**: Low - QSplitter is well-tested Qt component
**Impact**: Low - Minor layout issues

## Risk Distribution

### By Category

- Performance (PERF): 3 risks (2 high)
- Technical (TECH): 3 risks (0 high)
- Data (DATA): 2 risks (0 high)
- Operational (OPS): 1 risk (0 high)
- Security (SEC): 0 risks
- Business (BUS): 0 risks

### By Component

- ChartCanvas: 5 risks (PERF-001, PERF-002, TECH-001, DATA-001, OPS-001)
- FeatureExplorerTab: 4 risks (TECH-002, TECH-003, DATA-002, PERF-003)
- AppState Integration: 1 risk (TECH-002)

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests

1. **Performance validation with 100k points** - PERF-001
   - Test type: Load test, timing assertions
   - Must pass before story completion

2. **Column change timing test** - PERF-002
   - Test type: Performance integration test
   - Assert < 200ms end-to-end

### Priority 2: Medium Risk Tests

3. **OpenGL fallback behavior** - TECH-001
   - Test type: Manual testing on varied hardware
   - Document results

4. **NaN/Inf data handling** - DATA-001
   - Test type: Unit test with bad data
   - Assert graceful handling

### Priority 3: Low/Minimal Risk Tests

5. **Signal integration tests** - TECH-002
   - Test type: Widget tests
   - Covered by standard test suite

## Risk Acceptance Criteria

### Must Fix Before Production

- PERF-001: Must render 83k+ points without lag
- PERF-002: Must update chart < 200ms on column change

### Can Deploy with Monitoring

- TECH-001: OpenGL compatibility (most systems covered)
- DATA-001: NaN handling (add filtering, document behavior)

### Accepted Risks

- DATA-002, TECH-003: Minimal impact, edge cases handled by empty states

## Monitoring Requirements

Post-deployment monitoring for:

- Chart render failures (via `render_failed` signal)
- Memory usage with large datasets
- User reports of sluggish chart performance

## Risk Review Triggers

Review and update risk profile when:

- PyQtGraph version changes
- Target dataset size increases significantly
- New OpenGL-related bugs are reported
- Performance degradation observed in production
