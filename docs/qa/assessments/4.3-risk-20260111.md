# Risk Profile: Story 4.3

Date: 2026-01-11
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 7
- Critical Risks: 0
- High Risks: 1
- Risk Score: 81/100 (calculated)

## Risk Matrix

| Risk ID  | Description                           | Probability | Impact     | Score | Priority |
|----------|---------------------------------------|-------------|------------|-------|----------|
| BUS-001  | Incorrect improvement direction       | Medium (2)  | High (3)   | 6     | High     |
| TECH-001 | UI component complexity               | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-003 | Delta calculation edge cases          | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-001 | Metric field mismatches               | Low (1)     | Medium (2) | 2     | Low      |
| TECH-002 | Signal/slot integration               | Low (1)     | Low (1)    | 1     | Minimal  |
| PERF-001 | Animation performance                 | Low (1)     | Low (1)    | 1     | Minimal  |
| OPS-001  | Font inconsistency                    | Low (1)     | Low (1)    | 1     | Minimal  |

## High Risks Requiring Attention

### 1. BUS-001: Incorrect Improvement Direction

**Score: 6 (High)**

**Probability**: Medium - The improvement direction definitions (higher-is-better vs lower-is-better) involve 24 metrics across multiple categories. Human error in categorization is plausible, especially for nuanced metrics like `avg_loser` (higher is better because less negative).

**Impact**: High - Incorrect color coding would actively mislead users. A metric showing green/cyan when performance actually worsened could cause poor trading decisions with financial consequences.

**Mitigation**:
- Implement comprehensive unit tests for every metric's improvement direction
- Add explicit documentation of improvement logic for ambiguous metrics
- Review improvement definitions against domain expert knowledge
- Consider adding tooltip explanations for improvement colors

**Testing Focus**:
- Unit tests for all 24 metrics' improvement directions
- Edge cases: avg_loser, median_loser (higher = better because less negative)
- Neutral metric handling (num_trades)

## Medium Risks

### 2. TECH-001: UI Component Complexity

**Score: 4 (Medium)**

**Probability**: Medium - ComparisonGrid involves multiple nested widgets (_SectionHeader, _ComparisonRow), state management for section collapse, and animation coordination.

**Impact**: Medium - Complex UI could have rendering issues, state bugs, or poor UX if not carefully implemented.

**Mitigation**:
- Follow existing component patterns from MetricsGrid and ComparisonRibbon
- Use comprehensive widget tests with qtbot
- Start with simpler static layout before adding animations
- Leverage existing constants (Spacing, Colors, Fonts)

**Testing Focus**:
- Widget tests for section toggle behavior
- State persistence for collapse states
- Proper cleanup on widget destruction

### 3. TECH-003: Delta Calculation Edge Cases

**Score: 4 (Medium)**

**Probability**: Medium - Delta calculations must handle None values, string values ("Not recovered", "Blown"), and various numeric types.

**Impact**: Medium - Calculation errors would display incorrect deltas or cause runtime exceptions.

**Mitigation**:
- Implement robust type checking before calculations
- Handle None baseline gracefully (show "â€”" for all columns)
- Handle string DD duration values specially (no delta calculation possible)
- Comprehensive unit tests for edge cases

**Testing Focus**:
- None value handling in both baseline and filtered
- String DD duration values
- Zero baseline values (division protection if applicable)
- Very large delta values (formatting overflow)

## Low/Minimal Risks

### 4. DATA-001: Metric Field Mismatches

**Score: 2 (Low)**

**Probability**: Low - TradingMetrics fields are well-documented in Dev Notes with exact field names and formats.

**Impact**: Medium - Missing or misnamed fields would cause display errors.

**Mitigation**: Reference exact field names from TradingMetrics dataclass. Dev notes table provides complete mapping.

### 5. TECH-002: Signal/Slot Integration

**Score: 1 (Minimal)**

**Probability**: Low - `metrics_updated` signal pattern already proven in Story 4.2 (ComparisonRibbon).

**Impact**: Low - Integration follows established pattern; easy to debug if issues arise.

**Mitigation**: Follow exact pattern from ComparisonRibbon integration.

### 6. PERF-001: Animation Performance

**Score: 1 (Minimal)**

**Probability**: Low - QPropertyAnimation for 5 sections with ~5 rows each is minimal overhead.

**Impact**: Low - Worst case: choppy animation, easily fixable by adjusting duration or removing animation.

**Mitigation**: Use reasonable animation duration (150ms as specified). Could be disabled if issues found.

### 7. OPS-001: Font Inconsistency

**Score: 1 (Minimal)**

**Probability**: Low - Dev Notes explicitly clarify the AC error (JetBrains Mono vs Azeret Mono).

**Impact**: Low - Cosmetic inconsistency only.

**Mitigation**: Follow Dev Notes guidance to use `Fonts.DATA` (Azeret Mono) per project convention.

## Risk Distribution

### By Category
- Technical: 3 risks (0 critical)
- Business: 1 risk (1 high)
- Data: 1 risk (0 critical)
- Performance: 1 risk (0 critical)
- Operational: 1 risk (0 critical)

### By Component
- Frontend (ComparisonGrid): 6 risks
- Backend (calculation logic): 1 risk

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests
- BUS-001: Unit tests for improvement direction on ALL 24 metrics
- BUS-001: Integration test verifying color output matches expected direction

### Priority 2: Medium Risk Tests
- TECH-001: Widget tests for section collapse/expand state management
- TECH-003: Unit tests for delta calculation with None, strings, edge cases

### Priority 3: Low Risk Tests
- DATA-001: Verify all metric field names exist in TradingMetrics
- Standard functional tests for grid display

## Risk Acceptance Criteria

### Must Fix Before Production
- BUS-001: All improvement directions must be verified correct

### Can Deploy with Mitigation
- TECH-001, TECH-003: With comprehensive test coverage
- PERF-001: Monitor for lag, disable animation if needed

### Accepted Risks
- OPS-001: Font discrepancy between AC and implementation is documented and justified

## Monitoring Requirements

Post-deployment monitoring for:
- User feedback on color coding accuracy
- Performance metrics for section toggle responsiveness
- Error rates for delta calculation failures

## Risk Review Triggers

Review and update risk profile when:
- New metrics added to TradingMetrics
- Improvement direction definitions questioned by users
- Performance issues reported on section animations
- Architecture changes to signal/slot patterns
