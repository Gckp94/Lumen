# Risk Profile: Story 2.6 - Interactive Chart Controls

Date: 2026-01-11
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 0
- High Risks: 2
- Medium Risks: 1
- Low Risks: 2
- Minimal Risks: 1
- Risk Score: 71/100 (Moderate Risk)

## High Risks Requiring Attention

### 1. PERF-001: 60fps Render Performance with 83k Points

**Score: 6 (High)**

**Probability**: Medium - PyQtGraph with OpenGL should handle this volume, but edge cases exist with specific GPU configurations and data patterns. Prior Epic 2 stories indicate 83k point handling is achievable but requires careful configuration.

**Impact**: High - Core usability degraded. Users cannot effectively explore data if pan/zoom is laggy. This is an explicit NFR in AC 6.

**Mitigation**:
- Verify OpenGL acceleration enabled at app startup
- Set scatter point size to 3 with `pen=None`
- Enable `setClipToView(True)` for point culling
- Disable anti-aliasing on scatter plots
- Profile with actual 83k point dataset before release

**Testing Focus**:
- Performance test with 83k points measuring frame times
- Verify `pg.setConfigOptions(useOpenGL=True, antialias=False)` called
- Test on machines with varying GPU capabilities

---

### 2. TECH-001: Right-Click Zoom Rectangle Conflicts with Context Menu

**Score: 6 (High)**

**Probability**: High - PyQtGraph's default behavior shows a context menu on right-click. The dev notes explicitly call this out: "right-click shows context menu... need custom handling."

**Impact**: Medium - AC 1 specifically requires right-click drag for zoom selection. Without resolution, this AC cannot be met.

**Mitigation**:
- Disable default ViewBox context menu
- Implement custom right-button mouse event handler for rectangle zoom
- Consider `ViewBox.setMenuEnabled(False)` or custom menu override
- Alternative: Use modifier key (Shift+drag) if right-click proves problematic

**Testing Focus**:
- Widget test for right-click drag creating zoom selection
- Verify context menu does not appear during drag
- Test right-click without drag (edge case behavior)

---

## Medium Risks

### 3. TECH-002: Bidirectional Signal Loop (AxisControlPanel <-> ChartCanvas)

**Score: 4 (Medium)**

**Probability**: Medium - Signal loops are a common Qt pitfall. Dev notes provide correct pattern with `blockSignals()`, but implementation errors can still occur.

**Impact**: Medium - Could cause UI freezes, stack overflow, or infinite loops. Would manifest as application hang.

**Mitigation**:
- Use `blockSignals(True/False)` pattern in `set_range()` method
- Implement debounce timer (150ms as specified)
- Test bidirectional sync explicitly

**Testing Focus**:
- Unit test: `set_range()` does not emit `range_changed` signal
- Widget test: User input emits debounced signal
- Integration test: Chart range change updates panel without loop

---

## Low Risks

### 4. OPS-001: OpenGL Unavailable on Some Systems

**Score: 3 (Low)**

**Probability**: Low - Most modern systems support OpenGL. Desktop trading applications typically run on capable hardware.

**Impact**: High - Falls back to software rendering, failing 60fps requirement.

**Mitigation**:
- Document OpenGL requirement in system requirements
- Add startup check for OpenGL capability with user warning
- Consider graceful degradation (reduced point count) if OpenGL unavailable

**Testing Focus**:
- Test with `useOpenGL=False` to verify fallback behavior
- Document minimum GPU requirements

---

### 5. PERF-002: Mouse Move Event Overhead

**Score: 2 (Low)**

**Probability**: Low - PyQtGraph efficiently handles mouse move events. `sigMouseMoved` is well-optimized.

**Impact**: Medium - UI lag when moving crosshair.

**Mitigation**:
- Keep crosshair update logic minimal (position updates only)
- Avoid heavy computations in `_on_mouse_moved()`
- Consider throttling if issues arise

**Testing Focus**:
- Visual inspection during rapid mouse movement
- Performance profiling of mouse event handler

---

## Minimal Risks

### 6. TECH-003: Coordinate Mapping Accuracy

**Score: 1 (Minimal)**

**Probability**: Low - PyQtGraph's `mapSceneToView()` is well-tested and reliable.

**Impact**: Low - Incorrect coordinate display is annoying but not blocking.

**Mitigation**:
- Use standard PyQtGraph coordinate mapping APIs
- Test with known data points

**Testing Focus**:
- Unit test coordinate display format
- Manual verification of displayed coordinates

---

## Risk Distribution

### By Category

| Category | Count | Critical | High | Medium | Low |
|----------|-------|----------|------|--------|-----|
| Performance | 2 | 0 | 1 | 0 | 1 |
| Technical | 3 | 0 | 1 | 1 | 0 |
| Operational | 1 | 0 | 0 | 0 | 1 |

### By Component

| Component | Risks |
|-----------|-------|
| ChartCanvas | 5 (PERF-001, TECH-001, TECH-003, PERF-002, OPS-001) |
| AxisControlPanel | 1 (TECH-002) |

---

## Detailed Risk Register

| Risk ID | Category | Title | Probability | Impact | Score | Mitigation Strategy | Owner |
|---------|----------|-------|-------------|--------|-------|---------------------|-------|
| PERF-001 | Performance | 60fps with 83k points | Medium (2) | High (3) | 6 | OpenGL + optimizations | Dev |
| TECH-001 | Technical | Right-click context menu conflict | High (3) | Medium (2) | 6 | Custom mouse handler | Dev |
| TECH-002 | Technical | Bidirectional signal loop | Medium (2) | Medium (2) | 4 | blockSignals pattern | Dev |
| OPS-001 | Operational | OpenGL unavailability | Low (1) | High (3) | 3 | Documentation + check | Dev |
| PERF-002 | Performance | Mouse move overhead | Low (1) | Medium (2) | 2 | Minimal handler logic | Dev |
| TECH-003 | Technical | Coordinate mapping | Low (1) | Low (1) | 1 | Standard PyQtGraph API | Dev |

---

## Risk-Based Testing Strategy

### Priority 1: High Risk Tests

| Risk | Required Tests |
|------|----------------|
| PERF-001 | Performance test with 83k points, frame timing validation |
| TECH-001 | Widget test for right-click rectangle zoom, context menu suppression |

### Priority 2: Medium Risk Tests

| Risk | Required Tests |
|------|----------------|
| TECH-002 | Unit test for `set_range()` signal blocking, debounce verification |

### Priority 3: Low/Minimal Risk Tests

| Risk | Required Tests |
|------|----------------|
| OPS-001 | Fallback behavior test (optional) |
| PERF-002 | Visual inspection, profiling (manual) |
| TECH-003 | Coordinate format unit test |

---

## Risk Acceptance Criteria

### Must Fix Before Production

- **PERF-001**: 60fps requirement is explicit AC; cannot ship if failing
- **TECH-001**: Right-click zoom is explicit AC; must implement solution

### Can Deploy with Mitigation

- **TECH-002**: With proper `blockSignals()` implementation and testing
- **OPS-001**: With documented system requirements

### Accepted Risks

- **PERF-002**: Low probability, can address if reported
- **TECH-003**: Minimal impact, standard API usage should prevent

---

## Monitoring Requirements

Post-deployment monitoring for:

- **Performance**: Frame rate metrics during chart interactions
- **Error rates**: UI freeze or hang reports
- **User feedback**: Chart interaction usability complaints

---

## Risk Review Triggers

Review and update risk profile when:

- Performance issues reported by users
- New chart features added (additional rendering load)
- PyQtGraph library updated
- Target dataset sizes increase beyond 83k points
