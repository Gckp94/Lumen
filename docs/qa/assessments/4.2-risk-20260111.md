# Risk Profile: Story 4.2

Date: 2026-01-11
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 0
- High Risks: 0
- Medium Risks: 1
- Low Risks: 2
- Minimal Risks: 3
- Risk Score: 91/100 (Low Risk)

**Assessment:** This is a low-risk UI display component. No critical or high risks identified. Primary concern is delta calculation correctness which is mitigated by the explicit validation checkpoint (AC6) and comprehensive unit test coverage specified in the story tasks.

## Risk Matrix

| Risk ID   | Description                                | Probability | Impact     | Score | Priority |
|-----------|-------------------------------------------|-------------|------------|-------|----------|
| DATA-001  | Delta calculation correctness             | Medium (2)  | Medium (2) | 4     | Medium   |
| DATA-002  | Edge case handling (None/zero values)     | Medium (2)  | Low (1)    | 2     | Low      |
| BUS-001   | Incorrect color assignment misleads users | Low (1)     | Medium (2) | 2     | Low      |
| TECH-001  | Widget integration into existing layout   | Low (1)     | Low (1)    | 1     | Minimal  |
| PERF-001  | UI responsiveness with frequent updates   | Low (1)     | Low (1)    | 1     | Minimal  |
| OPS-001   | Insufficient logging for debugging        | Low (1)     | Low (1)    | 1     | Minimal  |

## Risk Distribution

### By Category

- Technical (TECH): 1 risk (0 critical)
- Performance (PERF): 1 risk (0 critical)
- Data (DATA): 2 risks (0 critical)
- Business (BUS): 1 risk (0 critical)
- Operational (OPS): 1 risk (0 critical)
- Security (SEC): 0 risks

### By Component

- Frontend (ComparisonRibbon): 6 risks
- Backend: 0 risks
- Database: 0 risks

## Detailed Risk Register

### DATA-001: Delta Calculation Correctness

**Score: 4 (Medium)**

**Probability**: Medium - Four different metrics with distinct delta calculations:
- `trades`: absolute difference (filtered - baseline)
- `win_rate`, `ev`, `kelly`: percentage point difference

**Impact**: Medium - Incorrect deltas would display misleading data to users, potentially affecting their trading decisions.

**Mitigation**:
- Strategy: Preventive
- Actions:
  - Implement `_calculate_delta()` helper with explicit metric-type handling (Task 3)
  - AC6 explicitly requires validation of calculation logic before building full grid
  - Unit tests specified in Task 8 cover all delta calculation scenarios
- Testing Requirements:
  - Unit tests for each metric type (trades absolute, percentage points)
  - Edge case tests for None values and zero baselines
- Residual Risk: Low - Comprehensive test coverage specified
- Owner: Dev
- Timeline: Before Task 4 completion

### DATA-002: Edge Case Handling

**Score: 2 (Low)**

**Probability**: Medium - Real-world data may include:
- None filtered metrics (no filter applied)
- Zero baseline values
- Very large or very small metric values

**Impact**: Low - Story explicitly handles these cases:
- AC5 specifies empty state for no filter
- Task 4 specifies handling for `filtered is None` and `baseline metric is None`

**Mitigation**:
- Strategy: Preventive
- Actions:
  - Implement `clear()` method for None filtered state (Task 5)
  - Task 4 explicitly handles None cases
  - Display "N/A" for missing baseline metrics
- Testing Requirements:
  - Unit tests for None value handling (Task 8)
  - Widget tests for clear() state (Task 9)
- Residual Risk: Minimal - Explicit handling in acceptance criteria
- Owner: Dev
- Timeline: Task 4-5

### BUS-001: Incorrect Color Assignment

**Score: 2 (Low)**

**Probability**: Low - Color logic is straightforward:
- Positive delta = SIGNAL_CYAN (improvement)
- Negative delta = SIGNAL_CORAL (decline)
- Zero delta = TEXT_SECONDARY (neutral)
- All 4 metrics use "higher is better" logic

**Impact**: Medium - Wrong colors would mislead users about whether a filter improves or worsens their metrics.

**Mitigation**:
- Strategy: Preventive
- Actions:
  - Document color mapping in Dev Notes (done)
  - Unit test delta color mapping (Task 8)
  - Widget test semantic colors (Task 9)
- Testing Requirements:
  - Test positive delta returns SIGNAL_CYAN
  - Test negative delta returns SIGNAL_CORAL
  - Test zero delta returns TEXT_SECONDARY
- Residual Risk: Minimal - Logic is simple and well-tested
- Owner: Dev
- Timeline: Task 3

### TECH-001: Widget Integration

**Score: 1 (Minimal)**

**Probability**: Low - Layout integration is well-documented:
- Current layout order documented in Dev Notes
- Clear instruction: "insert BEFORE Configuration section"
- Standard Qt layout manipulation

**Impact**: Low - Wrong position would be visually obvious and easily fixed.

**Mitigation**:
- Strategy: Detective
- Actions:
  - Manual verification step (Task 11)
  - Visual confirmation during testing
- Testing Requirements:
  - Integration test for ribbon position (Task 10)
  - Manual verification checklist
- Residual Risk: Minimal
- Owner: Dev
- Timeline: Task 6

### PERF-001: UI Responsiveness

**Score: 1 (Minimal)**

**Probability**: Low - Metric updates are infrequent (only on filter changes).

**Impact**: Low - Simple widget with minimal rendering overhead:
- 4 static cards with text updates
- No complex graphics or animations
- Signal updates are debounced by design

**Mitigation**:
- Strategy: None required
- Testing Requirements: Manual verification during Task 11
- Residual Risk: Minimal
- Owner: Dev
- Timeline: N/A

### OPS-001: Insufficient Logging

**Score: 1 (Minimal)**

**Probability**: Low - Task 4 specifies logging:
```python
logger.debug("Ribbon updated: %d trades filtered", filtered.num_trades)
```

**Impact**: Low - Can add logging post-implementation if debugging needed.

**Mitigation**:
- Strategy: Preventive
- Actions: Implement logging as specified in Task 4
- Residual Risk: Minimal
- Owner: Dev
- Timeline: Task 4

## Risk-Based Testing Strategy

### Priority 1: Medium Risk Tests (DATA-001)

**Focus Area**: Delta calculation correctness

Test Scenarios:
1. Calculate delta for trades (absolute difference)
2. Calculate delta for win_rate (percentage points)
3. Calculate delta for ev (percentage points)
4. Calculate delta for kelly (percentage points)
5. Verify positive delta returns "higher" improvement direction

### Priority 2: Low Risk Tests (DATA-002, BUS-001)

**Focus Area**: Edge cases and color semantics

Test Scenarios:
1. Handle None filtered metrics gracefully
2. Handle None baseline metric values
3. Verify color mapping for positive/negative/zero deltas
4. Verify empty state display

### Priority 3: Minimal Risk Tests (TECH-001, PERF-001, OPS-001)

**Focus Area**: Integration and visual verification

Test Scenarios:
1. Ribbon displays at top of PnL Stats tab
2. Signal triggers ribbon update
3. Manual visual inspection

## Risk Acceptance Criteria

### Must Fix Before Production

- None (no critical or high risks)

### Can Deploy with Mitigation

- DATA-001: Proceed with comprehensive unit test coverage
- All other risks acceptable with standard testing

### Accepted Risks

- All risks are at acceptable levels with planned mitigations

## Monitoring Requirements

Post-deployment monitoring:
- None required - low-risk display component
- Standard application logging sufficient

## Risk Review Triggers

Review and update risk profile when:
- New metrics added to ribbon
- Delta calculation logic changes
- Color semantics change
- Signal flow architecture changes
