# Story 1.1: Project Scaffolding

## Status

Done

## Story

**As a** developer,
**I want** a properly configured Python project with all dependencies,
**so that** I have a solid foundation for building Lumen.

## Acceptance Criteria

1. Project initialized with `uv` and `pyproject.toml` configuration
2. Directory structure created per Technical Assumptions
3. Core dependencies installed: PyQt6, pandas, pyarrow, pyqtgraph, openpyxl
4. `main.py` entry point creates basic `QApplication` and `QMainWindow`
5. Application runs without errors via `uv run python src/main.py`
6. Window appears with title "Lumen" and minimum size 1280x720
7. `.gitignore` configured for Python, PyQt, and `.lumen_cache/`

## Tasks / Subtasks

- [x] Task 1: Initialize Python project with uv (AC: 1)
  - [x] Run `uv init` to create basic project structure
  - [x] Configure `pyproject.toml` with project metadata (name="lumen", version="1.0.0", requires-python=">=3.11")
  - [x] Add tool configurations for black, ruff, isort, mypy, pytest per coding standards
  - [x] Run `uv sync` to create virtual environment and lockfile

- [x] Task 2: Create directory structure (AC: 2)
  - [x] Create `src/` directory with `__init__.py`
  - [x] Create `src/__version__.py` with version string
  - [x] Create `src/core/` directory with `__init__.py`
  - [x] Create `src/ui/` directory with `__init__.py`
  - [x] Create `src/ui/components/` directory with `__init__.py`
  - [x] Create `src/tabs/` directory with `__init__.py`
  - [x] Create `tests/` directory with `__init__.py` and `conftest.py`
  - [x] Create `tests/unit/`, `tests/widget/`, `tests/integration/` directories
  - [x] Create `assets/fonts/` directory (fonts will be added in Story 1.2)
  - [x] Create `.lumen_cache/` directory with `.gitkeep`

- [x] Task 3: Install core dependencies (AC: 3)
  - [x] Add runtime dependencies to pyproject.toml: PyQt6>=6.6.0, pyqtgraph>=0.13.0, pandas>=2.1.0, pyarrow>=14.0.0, openpyxl>=3.1.0
  - [x] Add dev dependencies: pytest>=8.0.0, pytest-qt>=4.3.0, pytest-cov>=4.1.0, black>=24.4.0, ruff>=0.4.0, mypy>=1.10.0, pandas-stubs, PyQt6-stubs, pre-commit>=3.7.0, pyinstaller>=6.0.0
  - [x] Run `uv sync` to install all dependencies
  - [x] Verify installation with import tests

- [x] Task 4: Create main.py entry point (AC: 4, 5, 6)
  - [x] Create `src/main.py` with QApplication and QMainWindow
  - [x] Set window title to "Lumen"
  - [x] Set minimum window size to 1280x720
  - [x] Add proper `if __name__ == "__main__"` guard
  - [x] Add basic logging setup
  - [x] Test run with `uv run python src/main.py`

- [x] Task 5: Configure .gitignore (AC: 7)
  - [x] Add standard Python ignores (__pycache__, *.pyc, .venv/, etc.)
  - [x] Add PyQt ignores (*.qmlc, etc.)
  - [x] Add `.lumen_cache/` directory
  - [x] Add IDE directories (.vscode/, .idea/)
  - [x] Add build artifacts (build/, dist/, *.spec)
  - [x] Add test/coverage artifacts (.pytest_cache/, htmlcov/, .coverage)

- [x] Task 6: Create Makefile with standard commands
  - [x] Add `run` target: `uv run python -m src.main`
  - [x] Add `test` target: `uv run pytest`
  - [x] Add `test-quick` target: `uv run pytest -m "not slow"`
  - [x] Add `lint` target: `uv run ruff check src tests`
  - [x] Add `format` target: `uv run black src tests`
  - [x] Add `typecheck` target: `uv run mypy src`

- [x] Task 7: Verify complete setup (AC: 5)
  - [x] Run `uv run python src/main.py` and verify window appears
  - [x] Run `uv run pytest` and verify test discovery works
  - [x] Run `uv run ruff check src` and verify linting works
  - [x] Run `uv run mypy src` and verify type checking works

## Dev Notes

### Project Structure
[Source: architecture/2-high-level-architecture.md#repository-structure]

```
Lumen/
├── src/
│   ├── __init__.py
│   ├── __version__.py          # Version string
│   ├── main.py                 # Entry point
│   ├── core/
│   │   ├── __init__.py
│   │   └── (future modules)
│   ├── ui/
│   │   ├── __init__.py
│   │   └── components/
│   │       └── __init__.py
│   └── tabs/
│       └── __init__.py
├── tests/
│   ├── __init__.py
│   ├── conftest.py             # Shared fixtures
│   ├── unit/
│   ├── widget/
│   └── integration/
├── assets/
│   └── fonts/                  # Fonts added in Story 1.2
├── .lumen_cache/               # Git-ignored cache directory
├── pyproject.toml
├── uv.lock
├── Makefile
└── .gitignore
```

### Tech Stack Requirements
[Source: architecture/3-tech-stack.md#technology-table]

| Category | Technology | Version | Purpose |
|----------|------------|---------|---------|
| Runtime | Python | 3.11+ | Core language |
| UI Framework | PyQt6 | 6.6+ | Desktop UI |
| Charting | PyQtGraph | 0.13+ | GPU-accelerated charts |
| Data Processing | Pandas | 2.1+ | DataFrame operations |
| File I/O | PyArrow | 14.0+ | Parquet read/write |
| Excel Reading | openpyxl | 3.1+ | .xlsx file support |
| Package Manager | uv | Latest | Fast dependency management |
| Formatter | Black | 24.4+ | Code formatting |
| Linter | Ruff | 0.4+ | Fast linting |
| Type Checker | mypy | 1.10+ | Static type analysis |
| Testing | pytest | 8.0+ | Test framework |
| Qt Testing | pytest-qt | 4.3+ | Widget testing |

### pyproject.toml Configuration
[Source: architecture/7-development-workflow.md#pyprojecttoml]

```toml
[project]
name = "lumen"
version = "1.0.0"
requires-python = ">=3.11"
dependencies = [
    "PyQt6>=6.6.0",
    "pyqtgraph>=0.13.0",
    "pandas>=2.1.0",
    "pyarrow>=14.0.0",
    "openpyxl>=3.1.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-qt>=4.3.0",
    "pytest-cov>=4.1.0",
    "black>=24.4.0",
    "ruff>=0.4.0",
    "mypy>=1.10.0",
    "pandas-stubs",
    "PyQt6-stubs",
    "pre-commit>=3.7.0",
    "pyinstaller>=6.0.0",
]

[tool.black]
line-length = 100
target-version = ["py311"]

[tool.isort]
profile = "black"
line_length = 100

[tool.ruff]
line-length = 100
select = ["E", "F", "W", "I", "UP", "B", "SIM"]

[tool.mypy]
python_version = "3.11"
strict = true

[tool.pytest.ini_options]
testpaths = ["tests"]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "widget: marks tests requiring Qt event loop",
]
```

### Makefile Configuration
[Source: architecture/7-development-workflow.md#makefile]

```makefile
.PHONY: run test test-quick lint format typecheck clean

run:
	uv run python -m src.main

test:
	uv run pytest

test-quick:
	uv run pytest -m "not slow"

lint:
	uv run ruff check src tests

format:
	uv run black src tests
	uv run ruff check --fix src tests

typecheck:
	uv run mypy src

clean:
	rm -rf build/ dist/ .pytest_cache/ .mypy_cache/ htmlcov/ .coverage
```

### Coding Standards
[Source: architecture/9-coding-standards.md]

- **Line length**: 100 characters
- **Python version**: 3.11+
- **Naming**:
  - Modules: snake_case (e.g., `filter_engine.py`)
  - Classes: PascalCase (e.g., `FilterEngine`)
  - Functions: snake_case (e.g., `apply_first_trigger()`)
  - Constants: SCREAMING_SNAKE (e.g., `MAX_FILTERS = 10`)
- **Type hints**: Required for all public APIs
- **Logging**: Use `logging.getLogger(__name__)` pattern

### main.py Template
[Source: architecture/2-high-level-architecture.md]

```python
"""Lumen - Trading Analytics Application."""
import logging
import sys

from PyQt6.QtWidgets import QApplication, QMainWindow

logger = logging.getLogger(__name__)


class MainWindow(QMainWindow):
    """Main application window."""

    def __init__(self) -> None:
        super().__init__()
        self.setWindowTitle("Lumen")
        self.setMinimumSize(1280, 720)


def main() -> int:
    """Application entry point."""
    logging.basicConfig(
        level=logging.INFO,
        format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    )
    logger.info("Starting Lumen")

    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    return app.exec()


if __name__ == "__main__":
    sys.exit(main())
```

### Testing

[Source: architecture/8-testing-strategy.md]

**Test File Location**: `tests/` directory with subdirectories:
- `tests/unit/` - Core logic tests (60% of tests)
- `tests/widget/` - UI component tests with pytest-qt (20% of tests)
- `tests/integration/` - Workflow tests (15% of tests)

**Test Standards**:
- Use pytest as the test framework
- Use pytest-qt for widget testing
- Shared fixtures in `tests/conftest.py`
- Mark slow tests with `@pytest.mark.slow`
- Mark widget tests with `@pytest.mark.widget`

**Initial conftest.py**:
```python
# tests/conftest.py
import pytest

# Fixtures will be added as needed in subsequent stories
```

**Verification**:
- Run `uv run pytest` to verify test discovery works
- No tests needed for this scaffolding story - just verify framework is functional

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-09 | 0.1 | Initial draft | SM Agent (Bob) |
| 2026-01-09 | 0.2 | Removed numpy.typing.mypy_plugin (numpy not in deps) | PO Agent (Sarah) |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

- Fixed Python version incompatibility: `.python-version` was set to 3.10 but project requires >=3.11. Updated with `uv python pin 3.11`
- Fixed ruff deprecation warning: Moved `select` from `[tool.ruff]` to `[tool.ruff.lint]`
- Fixed unused import in `tests/conftest.py`: Removed `import pytest` (will be added when fixtures are needed)

### Completion Notes List

- All 7 tasks completed successfully
- Project scaffolding complete with full directory structure
- All dependencies installed (49 packages)
- All verification checks pass: black, ruff, mypy, pytest
- main.py imports verified working
- pyproject.toml configured with updated ruff lint section format

### File List

| File | Status | Description |
|------|--------|-------------|
| pyproject.toml | Created | Project configuration with dependencies and tool settings |
| .python-version | Created | Python version pinned to 3.11 |
| uv.lock | Created | Dependency lockfile |
| Makefile | Created | Build automation with run/test/lint/format/typecheck targets |
| .gitignore | Modified | Comprehensive ignore patterns for Python/PyQt/IDE/build |
| src/__init__.py | Created | Package init |
| src/__version__.py | Created | Version string (1.0.0) |
| src/main.py | Created | Application entry point with QMainWindow |
| src/core/__init__.py | Created | Core module init |
| src/ui/__init__.py | Created | UI module init |
| src/ui/components/__init__.py | Created | Components module init |
| src/tabs/__init__.py | Created | Tabs module init |
| tests/__init__.py | Created | Tests package init |
| tests/conftest.py | Created | Shared pytest fixtures (placeholder) |
| tests/unit/__init__.py | Created | Unit tests package init |
| tests/widget/__init__.py | Created | Widget tests package init |
| tests/integration/__init__.py | Created | Integration tests package init |
| assets/fonts/ | Created | Directory for fonts (Story 1.2) |
| .lumen_cache/.gitkeep | Created | Cache directory placeholder |

---

## QA Results

### Review Date: 2026-01-09

### Reviewed By: Quinn (Test Architect)

### Risk Assessment Summary

**Review Depth**: Standard (no auto-escalation triggers)
- No auth/payment/security files touched
- Scaffolding story - tests not expected per story requirements
- Diff size: appropriate for scaffolding
- No previous gate status
- 7 acceptance criteria (moderate)

Risk profile previously generated: `docs/qa/assessments/1.1-risk-20260109.md`
- Total Risks: 6 (0 critical, 0 high, 1 medium, 4 low, 1 minimal)
- Risk Score: 87/100 (Low Risk)

### Code Quality Assessment

**Overall: Excellent**

The implementation follows the architecture documentation precisely with appropriate deviations where the documentation was outdated:

1. **main.py**: Clean, follows coding standards exactly. Proper type hints, logging setup, and QMainWindow configuration. Matches the template from architecture docs.

2. **pyproject.toml**: Correctly configured with all required dependencies. Dev Agent appropriately updated `[tool.ruff.lint]` section per ruff's current configuration format (architecture doc showed deprecated format).

3. **Directory Structure**: All required directories created with proper `__init__.py` files.

4. **Makefile**: All required targets present and functional.

5. **.gitignore**: Comprehensive coverage of Python, PyQt, IDE, and project-specific patterns.

### Requirements Traceability

| AC | Requirement | Status | Evidence |
|----|-------------|--------|----------|
| AC1 | uv + pyproject.toml | ✓ | pyproject.toml exists with correct metadata |
| AC2 | Directory structure | ✓ | All directories verified: src/, src/core/, src/ui/, src/ui/components/, src/tabs/, tests/, tests/unit/, tests/widget/, tests/integration/, assets/fonts/, .lumen_cache/ |
| AC3 | Core dependencies | ✓ | All 5 imports verified: PyQt6, pandas, pyarrow, pyqtgraph, openpyxl |
| AC4 | main.py entry point | ✓ | MainWindow class with QApplication verified |
| AC5 | Application runs | ✓ | `uv run python src/main.py` execution verified |
| AC6 | Window title/size | ✓ | Title="Lumen", MinSize=1280x720 verified |
| AC7 | .gitignore | ✓ | All required patterns present |

### Test Architecture Assessment

**Status: Appropriate for Story**

Per story requirements (Testing section): "No tests needed for this scaffolding story - just verify framework is functional."

- pytest collection: ✓ Works (0 tests collected as expected)
- pytest-qt: ✓ Installed and detected
- Test directories: ✓ Created with __init__.py files
- conftest.py: ✓ Present with placeholder comment

Test design document available: `docs/qa/assessments/1.1-test-design-20260109.md`
- 14 test scenarios designed for future implementation if needed
- All ACs have test coverage mapped

### Refactoring Performed

None required. Implementation is clean and follows standards.

### Compliance Check

- Coding Standards: ✓ All code passes black, ruff, and mypy
- Project Structure: ✓ Matches architecture/2-high-level-architecture.md
- Testing Strategy: ✓ Framework configured per architecture/8-testing-strategy.md
- All ACs Met: ✓ 7/7 acceptance criteria verified

### Improvements Checklist

All items are advisory for future consideration:

- [ ] Consider adding PowerShell equivalents for Makefile commands (Windows-native alternative)
- [ ] Add .pre-commit-config.yaml for automated hooks (mentioned in architecture but not required for this story)
- [ ] Add VS Code settings.json (mentioned in architecture but not required for this story)

### Security Review

No security concerns. This is a scaffolding story with no user input handling, network operations, or sensitive data.

### Performance Considerations

N/A for scaffolding story. No performance-critical code introduced.

### Files Modified During Review

None. No refactoring was necessary.

### Gate Status

Gate: **PASS** → docs/qa/gates/1.1-project-scaffolding.yml
Risk profile: docs/qa/assessments/1.1-risk-20260109.md
Test design: docs/qa/assessments/1.1-test-design-20260109.md

### Recommended Status

**✓ Ready for Done**

All 7 acceptance criteria met. Tooling verification passes:
- `uv run ruff check src`: All checks passed
- `uv run mypy src`: Success, no issues in 7 source files
- `uv run black --check src`: All files properly formatted
- `uv run pytest --collect-only`: Framework functional

Story owner may proceed to mark as Done.
